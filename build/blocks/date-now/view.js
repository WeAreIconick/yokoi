(()=>{"use strict";const e=window.wp.i18n,t=Array.from({length:11},(e,t)=>10+t),o=[(0,e.__)("Sunday","yokoi"),(0,e.__)("Monday","yokoi"),(0,e.__)("Tuesday","yokoi"),(0,e.__)("Wednesday","yokoi"),(0,e.__)("Thursday","yokoi"),(0,e.__)("Friday","yokoi"),(0,e.__)("Saturday","yokoi")],n=new WeakMap,a=e=>{if(!e)return null;const t=e.replace(/-/g,"/"),o=new Date(t);return Number.isNaN(o.getTime())?null:o},i=e=>e.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"}),d=e=>e.toLocaleDateString([],{weekday:"long",month:"long",day:"numeric"}),r=(e,t)=>{const o=new Date(e);return o.setDate(o.getDate()+t),o},s=t=>{const o=a(t.start),n=a(t.end)||o;return{id:t.id,title:t.title||(0,e.__)("Untitled event","yokoi"),description:t.description||"",location:t.location||"",link:t.link||"",allDay:Boolean(t.allDay),start:o,end:n}},l=e=>{try{return JSON.parse(e||"[]").map(s).filter(e=>e.start)}catch(e){return"undefined"!=typeof window&&window.yokoiDebug&&console.warn("Date.now: invalid events payload",e),[]}},c=(e,t,o)=>{const n=document.createElement(e);return t&&(n.className=t),o&&(n.textContent=o),n},_=(n,a,s)=>{n.innerHTML="",((t,o,n)=>{const a=c("div","yokoi-date-now__header"),i=c("div","yokoi-date-now__headline"),d=o.headline||(0,e.__)("Date.now","yokoi"),s=o.subheadline||(0,e.__)("A calm overview of your upcoming schedule.","yokoi");i.append(c("div","yokoi-date-now__headline-title",d),c("div","yokoi-date-now__headline-subtitle",s));const l=c("div","yokoi-date-now__controls"),_=c("button","",(0,e.__)("Today","yokoi"));_.addEventListener("click",()=>{n({currentDate:new Date})});const p=c("button","");p.setAttribute("aria-label",(0,e.__)("Previous period","yokoi")),p.innerHTML="←",p.addEventListener("click",()=>{const e="month"===o.view?-30:-7;n({currentDate:r(o.currentDate,e)})});const y=c("button","");y.setAttribute("aria-label",(0,e.__)("Next period","yokoi")),y.innerHTML="→",y.addEventListener("click",()=>{const e="month"===o.view?30:7;n({currentDate:r(o.currentDate,e)})}),l.append(p,_,y);const k=c("div","yokoi-date-now__controls");if([{key:"day",label:(0,e.__)("Day","yokoi")},{key:"week",label:(0,e.__)("Week","yokoi")},{key:"month",label:(0,e.__)("Month","yokoi")}].forEach(({key:e,label:t})=>{const a=c("button","",t);o.view===e&&a.setAttribute("aria-current","true"),a.addEventListener("click",()=>{n({view:e})}),k.append(a)}),"day"!==o.view){const t=c("button","");t.textContent=o.showWeekends?(0,e.__)("Hide weekends","yokoi"):(0,e.__)("Show weekends","yokoi"),t.addEventListener("click",()=>{n({showWeekends:!o.showWeekends})}),k.append(t)}a.append(i,l,k),t.append(a)})(n,a,s);const l=c("div","yokoi-date-now__body");switch(a.view){case"day":((t,o)=>{const n=o.currentDate,a=c("h2","yokoi-date-now__range-heading",d(n));t.append(a);const r=o.events.filter(e=>e.start&&e.start.toDateString()===n.toDateString());if(0===r.length)return void t.append(c("div","yokoi-date-now__empty",(0,e.__)("No events for this day.","yokoi")));const s=c("div","yokoi-date-now__day-list");r.sort((e,t)=>e.start-t.start).forEach(e=>{const t=c("div","yokoi-date-now__event yokoi-date-now__event--day");t.append(c("span","yokoi-date-now__event-time",`${i(e.start)} – ${i(e.end||e.start)}`),c("span","yokoi-date-now__event-title",e.title),e.location?c("span","yokoi-date-now__event-location",e.location):null),t.addEventListener("click",()=>p(e)),s.append(t)}),t.append(s)})(l,a);break;case"month":((t,n)=>{const a=new Date(n.currentDate.getFullYear(),n.currentDate.getMonth(),1),d=new Date(n.currentDate.getFullYear(),n.currentDate.getMonth()+1,0),r=c("h2","yokoi-date-now__range-heading",a.toLocaleDateString([],{month:"long",year:"numeric"}));t.append(r);const s=d.getDate(),l=c("div","yokoi-date-now__month-grid");for(let t=1;t<=s;t++){const d=new Date(a.getFullYear(),a.getMonth(),t),r=c("div","yokoi-date-now__month-cell"),s=c("div","yokoi-date-now__month-cell-heading");s.append(c("span","yokoi-date-now__month-cell-day",String(t)),c("span","yokoi-date-now__month-cell-weekday",o[d.getDay()].slice(0,3))),r.append(s);const _=n.events.filter(e=>e.start&&e.start.getMonth()===d.getMonth()&&e.start.getDate()===t).sort((e,t)=>e.start-t.start);if(0===_.length){l.append(r);continue}const y=c("ul","yokoi-date-now__month-events");_.slice(0,n.eventLimit).forEach(e=>{const t=c("li","yokoi-date-now__month-event");t.append(c("span","yokoi-date-now__month-event-time",i(e.start)),c("span","yokoi-date-now__month-event-title",e.title)),t.addEventListener("click",()=>p(e)),y.append(t)}),_.length>n.eventLimit&&y.append(c("span","yokoi-date-now__month-event-more",(0,e.__)("See all events","yokoi"))),r.append(y),l.append(r)}t.append(l)})(l,a);break;default:((e,n)=>{const a=(e=>{const t=new Date(e),o=t.getDay();return t.setHours(0,0,0,0),t.setDate(t.getDate()-o),t})(n.currentDate),d=Array.from({length:7},(e,t)=>r(a,t)).filter((e,t)=>n.showWeekends||0!==t&&6!==t),s=c("h2","yokoi-date-now__range-heading",((e,t)=>{const o=e.getMonth()===t.getMonth(),n=e.getFullYear()===t.getFullYear();return o&&n?e.toLocaleDateString([],{month:"long",year:"numeric"}):n?`${e.toLocaleDateString([],{month:"short"})} – ${t.toLocaleDateString([],{month:"short",year:"numeric"})}`:`${e.toLocaleDateString([],{month:"short",year:"numeric"})} – ${t.toLocaleDateString([],{month:"short",year:"numeric"})}`})(d[0],d[d.length-1]));e.append(s);const l=c("div","yokoi-date-now__calendar"),_=c("div","yokoi-date-now__time-column");t.forEach(e=>{const t=c("span","",`${e}:00`);_.append(t)}),l.append(_),d.forEach(e=>{const a=c("div","yokoi-date-now__day-column"),d=e.toDateString()===(new Date).toDateString();d&&a.classList.add("yokoi-date-now__day-column--today");const r=c("div","yokoi-date-now__day-header");r.append(c("span","yokoi-date-now__day-header-name",o[e.getDay()]));const s=c("span","yokoi-date-now__day-header-date"+(d?" yokoi-date-now__day-header-date--today":""),String(e.getDate()));r.append(s);const _=c("div","yokoi-date-now__grid");t.forEach(()=>{_.append(c("div","yokoi-date-now__grid-slot"))});const y=c("div","yokoi-date-now__events-layer");n.events.filter(t=>t.start&&t.start.toDateString()===e.toDateString()).forEach(e=>{const t=e.start.getHours()+e.start.getMinutes()/60,o=(e.end?e.end.getHours():t)+(e.end?e.end.getMinutes():0)/60,n=Math.max(o-t,.5),a=c("div","yokoi-date-now__event"),d=Math.max(0,56*(t-10)),r=Math.max(44,56*n);a.style.top=`${d}px`,a.style.height=`${r}px`,a.append(c("span","yokoi-date-now__event-time",`${i(e.start)} – ${i(e.end||e.start)}`),c("span","yokoi-date-now__event-title",e.title),e.location?c("span","yokoi-date-now__event-location",e.location):null),a.addEventListener("click",()=>p(e)),y.append(a)}),a.append(r,_,y),l.append(a)}),e.append(l)})(l,a)}n.append(l)},p=t=>{const o=c("div","yokoi-date-now__popup-overlay"),n=c("div","yokoi-date-now__popup"),a=c("div","yokoi-date-now__popup-header");a.append(c("h3","",t.title),c("button","","×"));const r=c("div","yokoi-date-now__popup-meta");r.append(c("span","",d(t.start)),c("span","",`${i(t.start)} – ${i(t.end||t.start)}`)),t.location&&r.append(c("span","",t.location));const s=c("p","yokoi-date-now__popup-description"+(t.description?"":" yokoi-date-now__popup-description--empty"),t.description||(0,e.__)("No additional details provided.","yokoi")),l=c("div","yokoi-date-now__popup-footer");if(t.link){const o=c("a","",(0,e.__)("Open in Google Calendar","yokoi"));o.href=t.link,o.target="_blank",o.rel="noopener noreferrer",l.append(o)}n.append(a,r,s,l),o.append(n),document.body.append(o);const _=()=>{o.remove()};o.addEventListener("click",e=>{e.target===o&&_()}),a.querySelector("button").addEventListener("click",_)},y=()=>{const e=document.querySelectorAll(".yokoi-date-now__card");e.length&&e.forEach(e=>(e=>{const t={events:l(e.dataset.events),currentDate:new Date,view:e.dataset.defaultView||"week",showWeekends:"0"!==e.dataset.showWeekends,eventLimit:Number.parseInt(e.dataset.eventLimit||"3",10),headline:e.dataset.headline||"",subheadline:e.dataset.subheadline||""},o=t=>{const a={...n.get(e),...t};n.set(e,a),_(e,a,o)};n.set(e,t),_(e,t,o)})(e))};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",y):y()})();