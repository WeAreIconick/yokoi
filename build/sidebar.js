(()=>{"use strict";var e,o={96:(e,o,a)=>{const i=window.wp.plugins,s=window.wp.components,n=window.wp.apiFetch;var t=a.n(n);const l=window.wp.i18n,r=window.wp.element,c=window.wp.domReady;var d=a.n(c);const _=window.wp.url,u=window.ReactJSXRuntime,p=({isLoading:e=!1,isLoadingMore:o=!1,error:a=null,searchValue:i="",onSearchChange:n=()=>{},blocksEnabled:t={},blockDefinitions:c={},onToggle:d,hasMore:_=!1,onLoadMore:p=()=>{},dateNowApiKey:b="",onDateNowApiKeyChange:g=()=>{}})=>{var h;const k=(Object.keys(c).length?Object.keys(c):Object.keys(t)).map(e=>{var o;return[e,null===(o=t?.[e])||void 0===o||o]}),y=null!==(h=i?.toLowerCase?.())&&void 0!==h?h:"",w=k.filter(([e])=>!y||`${c[e]?.title||e} ${c[e]?.description||""}`.toLowerCase().includes(y));return(0,u.jsx)(s.Panel,{children:(0,u.jsxs)(s.PanelBody,{title:(0,l.__)("Enable/Disable Blocks","yokoi"),initialOpen:!0,children:[(0,u.jsx)(s.SearchControl,{value:i,onChange:n,placeholder:(0,l.__)("Search blocks…","yokoi")}),e&&(0,u.jsx)(s.PanelRow,{className:"yokoi-sidebar__panel-row",children:(0,u.jsx)("p",{className:"yokoi-sidebar__loading-message",children:(0,l.__)("Loading block catalog…","yokoi")})}),a&&!e&&(0,u.jsx)(s.PanelRow,{className:"yokoi-sidebar__panel-row",children:(0,u.jsx)("p",{className:"yokoi-sidebar__error",children:a?.message||(0,l.__)("Unable to load block catalog.","yokoi")})}),0===k.length&&(0,u.jsx)(s.PanelRow,{className:"yokoi-sidebar__panel-row yokoi-sidebar__panel-row--empty",children:(0,u.jsx)("p",{className:"yokoi-sidebar__empty",children:(0,l.__)("No blocks registered yet. Blocks will appear here once available.","yokoi")})}),!e&&0===w.length&&k.length>0&&(0,u.jsx)(s.PanelRow,{className:"yokoi-sidebar__panel-row yokoi-sidebar__panel-row--empty",children:(0,u.jsx)("p",{className:"yokoi-sidebar__empty",children:(0,l.__)("No blocks match your search.","yokoi")})}),w.map(([e,o])=>{const a=c[e]?.title||e,i=c[e]?.description,n="yokoi/date-now"===e;return(0,u.jsxs)(r.Fragment,{children:[(0,u.jsx)(s.PanelRow,{className:"yokoi-sidebar__panel-row",children:(0,u.jsx)(s.ToggleControl,{label:a,checked:Boolean(o),onChange:()=>d(e),help:i,__nextHasNoMarginBottom:!0})}),n&&(0,u.jsx)(s.PanelRow,{className:"yokoi-sidebar__panel-row yokoi-sidebar__panel-row--date-now",children:(0,u.jsx)(s.TextControl,{label:(0,l.__)("Google Calendar API key","yokoi"),value:b,onChange:g,placeholder:"AIza..."})})]},e)}),_&&!e&&(0,u.jsx)(s.PanelRow,{className:"yokoi-sidebar__panel-row yokoi-sidebar__panel-row--load-more",children:(0,u.jsx)(s.Button,{variant:"secondary",onClick:p,isBusy:o,disabled:o,children:o?(0,l.__)("Loading…","yokoi"):(0,l.__)("Load more blocks","yokoi")})})]})})},b=window.yokoiSettings||{},g=Array.isArray(b.blocks)?b.blocks:[],h="yokoi-settings-sidebar",k=()=>{const e=window?.wp?.data;if(!e?.dispatch)return;const o=e.dispatch("core/edit-site");if(o?.openGeneralSidebar)return void o.openGeneralSidebar(`edit-site/plugin-sidebar/${h}`);const a=e.dispatch("core/edit-post");a?.openGeneralSidebar&&a.openGeneralSidebar(`edit-post/plugin-sidebar/${h}`)},y=(e=[])=>e.reduce((e,o)=>(o?.name&&(e[o.name]=o),e),{}),w=(e,o)=>{const a=((e={})=>({blocks_enabled:Object.fromEntries(Object.keys(e).map(e=>[e,!0])),default_configs:{},visibility_controls:{},date_now_api_key:""}))(o),i={...a,...e||{}};return i.blocks_enabled={...a.blocks_enabled,...e?.blocks_enabled||{}},Object.keys(o).forEach(e=>{"boolean"!=typeof i.blocks_enabled[e]&&(i.blocks_enabled[e]=Boolean(a.blocks_enabled[e]))}),i.default_configs={...a.default_configs,...e?.default_configs||{}},i.visibility_controls={...a.visibility_controls,...e?.visibility_controls||{}},i.date_now_api_key="string"==typeof e?.date_now_api_key?e.date_now_api_key:a.date_now_api_key,i};b?.nonce&&t().use(t().createNonceMiddleware(b.nonce));let m=null,f=null;const v=(e={})=>(0,u.jsxs)("svg",{className:"yokoi-sidebar__icon",width:"20",height:"20",viewBox:"0 0 163.3 163.3",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",focusable:"false",...e,children:[(0,u.jsx)("path",{d:"M145.1,38.5c0-1.2-.9-2.1-2.1-2.1H20.3c-1.2,0-2.1.9-2.1,2.1v104.4c0,1.2.9,2.1,2.1,2.1h122.7c1.2,0,2.1-.9,2.1-2.1V38.5ZM0,161.9V1.5C.6.5,1.8,0,3.5,0,51.6,0,98.1,0,143.1,0c1.2,0,2.1.9,2.1,2.1v13.9c0,1.2.9,2.1,2.1,2.2.6,0,5.2,0,13.9,0,1.4,0,2.1.8,2.1,2.4,0,3.5,0,50,0,139.5,0,2.2-.6,3.1-2.8,3.1-53,0-105.9,0-158.9,0,0,0-.2,0-.2,0l-1.4-1.3",fill:"currentColor"}),(0,u.jsx)("path",{d:"M75.2,86.9c0,1.2-.9,2.1-2.1,2.1h-8.8c-1.2,0-2.1-1-2.1-2.1v-18.2c0-1.2,1-2.1,2.1-2.1h8.8c1.2,0,2.1,1,2.1,2.1v18.2Z",fill:"currentColor"}),(0,u.jsx)("path",{d:"M101.1,86.9c0,1.2-.9,2.1-2.1,2.1h-8.8c-1.2,0-2.1-.9-2.1-2.1v-18.2c0-1.2.9-2.1,2.1-2.1h8.8c1.2,0,2.1.9,2.1,2.1v18.2Z",fill:"currentColor"}),(0,u.jsx)("path",{d:"M81.6,101.8c19.6,0,29.5,0,29.7,0,1.1,0,1.9-.9,1.9-2v-8.1c0-1.1.9-2,2-2h9c1.1,0,2,.9,2,2v8.9c0,1.1-.9,2.1-2.1,2.1h-8.2c-1.1,0-1.9.8-1.9,1.9v8.1c0,1.1-.9,1.9-1.9,2,0,0-10.2,0-30.5,0-20.3,0-30.5,0-30.5,0-1.1,0-1.9-1-1.9-2v-8.1c0-1-.9-1.9-2-1.9h-8.2c-1.1,0-2.1-.9-2.1-2.1v-8.9c0-1.1.9-2,2-2h9c1.1,0,2,.9,2,2v8.1c0,1.1.9,1.9,1.9,2,.2,0,10,0,29.7,0Z",fill:"currentColor"})]}),j=e=>e?"string"==typeof e?e:e?.message?e.message:(0,l.__)("An unexpected error occurred.","yokoi"):"",x=()=>{if(!m||!f)return null;const[e,o]=(0,r.useState)(()=>y(g)),[a,i]=(0,r.useState)(!1),[n,c]=(0,r.useState)(null),[d,h]=(0,r.useState)(""),[k,x]=(0,r.useState)(""),[S,C]=(0,r.useState)({page:0,totalPages:0,search:""}),[P,N]=(0,r.useState)(!1);(0,r.useEffect)(()=>{const e=setTimeout(()=>{x(d)},300);return()=>clearTimeout(e)},[d]);const M=(0,r.useCallback)((o,a=e)=>w(o,a),[e]),[O,E]=(0,r.useState)(w(b.settings,e)),[L,T]=(0,r.useState)(!b.settings),[B,R]=(0,r.useState)(!1),[A,G]=(0,r.useState)(!1),[I,D]=(0,r.useState)(null),[Y,F]=(0,r.useState)(!1);(0,r.useEffect)(()=>{var e;O&&(e=O,"undefined"!=typeof window&&(window.yokoiSettings={...window.yokoiSettings||{},settings:e},window.dispatchEvent(new CustomEvent("yokoi:settings-updated",{detail:e}))))},[O]);const K=!1!==b?.capabilities?.canManage,V=b?.restEndpoint,Z=b?.blocksEndpoint,$=(0,r.useCallback)((o,a=e)=>M(o,a),[M,e]),X=(0,r.useCallback)(async({search:e="",page:a=1,append:s=!1}={})=>{if(Z){c(null),s?N(!0):i(!0);try{const i=(0,_.addQueryArgs)(Z,{per_page:100,page:a,...e?{search:e}:{}}),n=await t()({url:i,method:"GET",parse:!1}),l=await n.json();if(!n.ok)throw l;const r=parseInt(n.headers.get("X-WP-Total"),10)||l.length||0,c=parseInt(n.headers.get("X-WP-TotalPages"),10)||Math.max(1,Math.ceil(r/100)),d=y(Array.isArray(l)?l:[]);let u=d;o(e=>(u=s?{...e,...d}:d,u)),E(e=>w(e,u)),C({page:a,totalPages:c,search:e})}catch(o){c(o),s||C({page:0,totalPages:0,search:e})}finally{s?N(!1):i(!1)}}},[Z]),H=(0,r.useCallback)(()=>{V&&K?(T(!0),t()({url:V,method:"GET"}).then(e=>{E($(e)),G(!1),Y&&F(!1),D(null)}).catch(e=>{D(e)}).finally(()=>{T(!1)})):T(!1)},[V,K,$,Y]);(0,r.useEffect)(()=>{b.settings||H()},[H]),(0,r.useEffect)(()=>{Z&&X({search:k,page:1,append:!1})},[Z,k,X]);const U=(0,r.useMemo)(()=>O?.blocks_enabled||{},[O]),W=O?.date_now_api_key||"",z=(0,r.useCallback)(e=>{E(o=>({...o,blocks_enabled:{...o.blocks_enabled,[e]:!o.blocks_enabled?.[e]}})),G(!0)},[]),J=(0,r.useCallback)(e=>{E(o=>({...o,date_now_api_key:e})),G(!0)},[]),Q=S.page>0&&S.page<S.totalPages,q=(0,r.useCallback)(()=>{Z&&(S.page>=S.totalPages||X({search:S.search,page:S.page+1,append:!0}))},[Z,S,X]),ee=(0,r.useCallback)(()=>{V&&(R(!0),D(null),t()({url:V,method:"POST",data:{blocks_enabled:O.blocks_enabled,default_configs:O.default_configs,visibility_controls:O.visibility_controls,date_now_api_key:O.date_now_api_key||"",nonce:b?.settingsNonce}}).then(e=>{const o=$(e?.data||e);E(o),G(!1),F(!0),setTimeout(()=>F(!1),3e3)}).catch(e=>{D(e)}).finally(()=>{R(!1)}))},[V,O,$]);return K?(0,u.jsxs)(r.Fragment,{children:[(0,u.jsx)(f,{target:"yokoi-settings-sidebar",icon:(0,u.jsx)(v,{}),children:(0,l.__)("Yokoi Settings","yokoi")}),(0,u.jsxs)(m,{name:"yokoi-settings-sidebar",title:(0,l.__)("Yokoi Settings","yokoi"),icon:(0,u.jsx)(v,{}),children:[L&&(0,u.jsxs)("div",{className:"yokoi-sidebar__loading",children:[(0,u.jsx)(s.Spinner,{}),(0,u.jsx)("p",{children:(0,l.__)("Loading settings…","yokoi")})]}),Y&&(0,u.jsx)(s.Notice,{status:"success",isDismissible:!1,children:(0,l.__)("Settings saved successfully.","yokoi")}),I&&(0,u.jsx)(s.Notice,{status:"error",onRemove:()=>D(null),children:j(I)}),(0,u.jsx)(p,{isLoading:a,isLoadingMore:P,error:n,searchValue:d,onSearchChange:h,hasMore:Q,onLoadMore:q,blocksEnabled:U,blockDefinitions:e,onToggle:z,dateNowApiKey:W,onDateNowApiKeyChange:J}),(0,u.jsxs)("div",{className:"yokoi-sidebar__footer",children:[(0,u.jsx)(s.Button,{variant:"secondary",onClick:H,isBusy:L,disabled:B,children:(0,l.__)("Reset","yokoi")}),(0,u.jsx)(s.Button,{variant:"primary",onClick:ee,isBusy:B,disabled:!A||B,children:B?(0,l.__)("Saving…","yokoi"):(0,l.__)("Save Settings","yokoi")})]})]})]}):(0,u.jsxs)(r.Fragment,{children:[(0,u.jsx)(PluginSidebarMoreMenuItem,{target:"yokoi-settings-sidebar",icon:"admin-settings",children:(0,l.__)("Yokoi Settings","yokoi")}),(0,u.jsx)(PluginSidebar,{name:"yokoi-settings-sidebar",title:(0,l.__)("Yokoi Settings","yokoi"),icon:"admin-settings",children:(0,u.jsx)("p",{children:(0,l.__)("You do not have permission to manage Yokoi settings.","yokoi")})})]})};d()(()=>{const e=window?.wp?.editor,o=window?.wp?.editSite,a=document?.body?.classList?.contains("site-editor-php")||document?.body?.classList?.contains("edit-site");if(!o||!a)return;const s=e?.PluginSidebar&&e?.PluginSidebarMoreMenuItem?e:o,{PluginSidebar:n,PluginSidebarMoreMenuItem:t}=s||{};n&&t&&(m=n,f=t,(0,i.registerPlugin)("yokoi-settings-sidebar",{render:x,icon:v}),(()=>{try{return"1"===new URLSearchParams(window.location.search).get("yokoi_sidebar")}catch(e){return!1}})()&&window.setTimeout(k,250))})}},a={};function i(e){var s=a[e];if(void 0!==s)return s.exports;var n=a[e]={exports:{}};return o[e](n,n.exports,i),n.exports}i.m=o,e=[],i.O=(o,a,s,n)=>{if(!a){var t=1/0;for(d=0;d<e.length;d++){for(var[a,s,n]=e[d],l=!0,r=0;r<a.length;r++)(!1&n||t>=n)&&Object.keys(i.O).every(e=>i.O[e](a[r]))?a.splice(r--,1):(l=!1,n<t&&(t=n));if(l){e.splice(d--,1);var c=s();void 0!==c&&(o=c)}}return o}n=n||0;for(var d=e.length;d>0&&e[d-1][2]>n;d--)e[d]=e[d-1];e[d]=[a,s,n]},i.n=e=>{var o=e&&e.__esModule?()=>e.default:()=>e;return i.d(o,{a:o}),o},i.d=(e,o)=>{for(var a in o)i.o(o,a)&&!i.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:o[a]})},i.o=(e,o)=>Object.prototype.hasOwnProperty.call(e,o),(()=>{var e={61:0,118:0};i.O.j=o=>0===e[o];var o=(o,a)=>{var s,n,[t,l,r]=a,c=0;if(t.some(o=>0!==e[o])){for(s in l)i.o(l,s)&&(i.m[s]=l[s]);if(r)var d=r(i)}for(o&&o(a);c<t.length;c++)n=t[c],i.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return i.O(d)},a=globalThis.webpackChunkyokoi=globalThis.webpackChunkyokoi||[];a.forEach(o.bind(null,0)),a.push=o.bind(null,a.push.bind(a))})();var s=i.O(void 0,[118],()=>i(96));s=i.O(s)})();